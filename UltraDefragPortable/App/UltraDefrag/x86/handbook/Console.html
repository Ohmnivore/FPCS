<!-- HTML header for doxygen 1.8.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<meta name="keywords" content="UltraDefrag, Ultra Defragmenter, defragmentation, Open Source disk defragmenter, defragger, boot time defragmentation, boot time defragger, handbook, user manual, index, table of contents, TOC" />
<title>UltraDefrag Handbook: Console Interface - 6.0.2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom_doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" style="width: 100%; height: 100%">
 <tbody>
 <tr>
  <td id="projectlogo"><a href="http://ultradefrag.sourceforge.net/"><img alt="ultradefrag homepage" src="udefrag80x15-colored-light.gif"/></a></td>
  <td id="sourceforgelogo"><a href="http://sourceforge.net/p/ultradefrag"><img alt="ultradefrag project" src="sflogo.gif"/></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname"><a href="index.html" class="index_pointer">UltraDefrag Handbook</a>
   &#160;<span id="projectnumber">6.0.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('Console.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Console Interface </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The UltraDefrag installer places the command line tool <b>udefrag.exe</b> into the System32 directory. Therefore it may be run without specifying the full path. <a href="http://ultradefrag.sourceforge.net/screenshots.html">View screenshots...</a></p>
<h1>Command line options</h1>
<p>Usage: </p>
<div class="fragment"><div class="line">udefrag [command] [options] [driveletter:] [path(s)]</div>
</div><!-- fragment --><p>Commands: </p>
<dl class="section user"><dt>-a, --analyze</dt><dd>Analyze the disk.</dd></dl>
<dl class="section user"><dt>--defragment</dt><dd>Defragment the disk. This is the default action.</dd></dl>
<dl class="section user"><dt>--optimize-mft</dt><dd>Optimize the MFT by placing its fragments as close to each other as possible. This is also included in full and quick optimization.</dd></dl>
<dl class="section user"><dt>-q, --quick-optimize</dt><dd>Optimize the disk space by moving not fragmented files to the beginning of the disk.</dd></dl>
<dl class="section user"><dt>-o, --optimize</dt><dd>Optimize the disk space by moving all files to the beginning of the disk.</dd></dl>
<dl class="section user"><dt>-l, --list-available-volumes</dt><dd>List all disks available for defragmentation, except removable. Each line of the output contains a drive letter, filesystem name, total space and amount of free space.</dd></dl>
<dl class="section user"><dt>-la, --list-available-volumes=all</dt><dd>List all disks available for defragmentation, including removable.</dd></dl>
<dl class="section user"><dt>-h, -?, --help</dt><dd>Show help screen. Running UltraDefrag without arguments has the same effect.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The commands are exclusive and can't be combined with each other.</dd></dl>
<p>Options: </p>
<dl class="section user"><dt>-r, --repeat</dt><dd>Defragment or optimize the disk until there is nothing left that can be moved. This will process the disk multiple times in a row if needed and possible.</dd></dl>
<dl class="section user"><dt>-b, --use-system-color-scheme</dt><dd>Use system color scheme (usually black/white) instead of the green color.</dd></dl>
<dl class="section user"><dt>-p, --suppress-progress-indicator</dt><dd>Hide progress indicator.</dd></dl>
<dl class="section user"><dt>-v, --show-volume-information</dt><dd>Show disk information after a job completes.</dd></dl>
<dl class="section user"><dt>-m, --show-cluster-map</dt><dd>Show a map representing clusters of the disk.</dd></dl>
<dl class="section user"><dt>--map-border-color=color</dt><dd>Set cluster map border color. Available values: black, white, red, green, blue, yellow, magenta, cyan, darkred, darkgreen, darkblue, darkyellow, darkmagenta, darkcyan, gray. Yellow color is used by default.</dd></dl>
<dl class="section user"><dt>--map-symbol=x</dt><dd>Set the character used for the map drawing. There are two accepted formats: a character may be typed directly, or its hexadecimal number may be used. For example, --map-symbol=0x1 forces UltraDefrag to use a smile character for the map drawing. Valid numbers are in the range of 0x1 to 0xFF. The % symbol is used by default.</dd></dl>
<dl class="section user"><dt>--map-rows=n</dt><dd>Number of rows of the cluster map. Default value is 10.</dd></dl>
<dl class="section user"><dt>--map-symbols-per-line=n</dt><dd>Number of map symbols contained in each row of the map. Default value is 68.</dd></dl>
<dl class="section user"><dt>--use-entire-window</dt><dd>Expand cluster map to use entire console window.</dd></dl>
<dl class="section user"><dt>--wait</dt><dd>Wait until already running instance of UltraDefrag completes before starting the job (useful for the scheduled defragmentation).</dd></dl>
<dl class="section user"><dt>--shellex</dt><dd>This option forces to list objects to be processed and display a prompt to hit any key after a job completion. It is intended for use in Explorer's context menu handler.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>All the environment variables listed below are ignored when the --shellex switch is on the command line. Instead of taking environment variables into account the program interprets the %UD_INSTALL_DIR%\options\guiopts.lua file.</dd></dl>
<p>Drive letter: </p>
<ul>
<li>
Specifying just the drive letter will cause UltraDefrag to defragment the disk. </li>
<li>
It is possible to specify multiple drive letters. Like this: udefrag c: d: x: </li>
<li>
<p class="startli">Also the following keys can be used instead of the drive letter:</p>
<dl class="section user"><dt>--all</dt><dd>Process all available disks.</dd></dl>
<dl class="section user"><dt>--all-fixed</dt><dd>Process all disks except removable.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The --all-fixed key has higher precedence, if both keys are specified UltraDefrag will process fixed drives only. </dd></dl>
</li>
</ul>
<p>Path:</p>
<ul>
<li>Specifying a path will cause UltraDefrag to defragment only the specified path.</li>
<li>It is possible to specify multiple paths separated by spaces.</li>
<li>Paths including spaces must be enclosed by double quotes (").</li>
<li>Relative and absolute paths are supported.<br/>
 Example: <div class="fragment"><div class="line">udefrag <span class="stringliteral">&quot;%USERPROFILE%&quot;</span> ..\Test <span class="stringliteral">&quot;My Documents&quot;</span> C:\WINDOWS\WindowsUpdate.log</div>
</div><!-- fragment --></li>
<li>Short paths (like C:\PROGRA~1\SOMEFI~1.TXT) aren't accepted on NT4.</li>
</ul>
<h1>Environment variables</h1>
<h2>Filter variables</h2>
 <dl class="section user"><dt>UD_IN_FILTER</dt><dd>List of file patterns to be included in the defragmentation process. File patterns must be separated by semicolons.</dd></dl>
<dl class="section user"><dt>UD_EX_FILTER</dt><dd>List of file patterns to be excluded from the defragmentation process. File patterns must be separated by semicolons.</dd></dl>
<dl class="section user"><dt>UD_FRAGMENT_SIZE_THRESHOLD</dt><dd>Eliminate only fragments smaller than specified.<br/>
The following size suffixes are accepted: KB, MB, GB, TB, PB, EB.</dd></dl>
<dl class="section user"><dt>UD_FILE_SIZE_THRESHOLD</dt><dd>Exclude all files larger than the specified size.<br/>
The following size suffixes are accepted: KB, MB, GB, TB, PB, EB.</dd></dl>
<dl class="section user"><dt>UD_OPTIMIZER_FILE_SIZE_THRESHOLD</dt><dd>In optimization sort out files smaller than specified only.<br/>
The following size suffixes are accepted: KB, MB, GB, TB, PB, EB.<br/>
The default value is 20MB.</dd></dl>
<dl class="section user"><dt>UD_FRAGMENTS_THRESHOLD</dt><dd>Exclude all files which have less fragments than the specified number.</dd></dl>
<dl class="section user"><dt>UD_SORTING</dt><dd>Set the file sorting method for the disk optimization. PATH is used by default, it forces to sort files by their paths. Four more options are available: SIZE (sort by size), C_TIME (sort by creation time), M_TIME (sort by last modification time) and A_TIME (sort by last access time).</dd></dl>
<dl class="section user"><dt>UD_SORTING_ORDER</dt><dd>Set the file sorting order for the disk optimization. ASC (ascending) is used by default. DESC (descending) forces to sort files in descending order.</dd></dl>
<dl class="section user"><dt>UD_FRAGMENTATION_THRESHOLD</dt><dd>Set the fragmentation threshold, in percents. When the disk fragmentation level is below the specified value, all the disk processing jobs except of the MFT optimization will be not performed. </dd></dl>
<h2>Process variables</h2>
 <dl class="section user"><dt>UD_TIME_LIMIT</dt><dd>When the specified time interval elapses the job will be terminated automatically.<br/>
 The following time format is accepted: Ay Bd Ch Dm Es.<br/>
 Here A,B,C,D,E represent any integer number, y,d,h,m,s - suffixes represent years, days, hours, minutes and seconds.</dd></dl>
<dl class="section user"><dt>UD_REFRESH_INTERVAL</dt><dd>Progress refresh interval, in milliseconds. The default value is 100.</dd></dl>
<dl class="section user"><dt>UD_DISABLE_REPORTS</dt><dd>If this environment variable is set to 1 (one), no file fragmentation report will be generated. </dd></dl>
<h2>Debug variables</h2>
 <dl class="section user"><dt>UD_DBGPRINT_LEVEL</dt><dd>Control amount of the debugging output. NORMAL is used by default, DETAILED may be used to collect information for the bug report, PARANOID turns on a really huge amount of debugging information.</dd></dl>
<dl class="section user"><dt>UD_LOG_FILE_PATH</dt><dd>If this variable is set, it should contain the path (including filename) to the log file to save debugging output into.<br/>
If the variable is not set, no logging to a file will be performed.</dd></dl>
<dl class="section user"><dt>UD_DRY_RUN</dt><dd>If this environment variable is set to 1 (one) the files are not physically moved. This allows testing the algorithm without changing the content of the disk. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>All filters are case insensitive. Each filter substring represents a pattern, UltraDefrag will compare with paths. For example, the "*temp*;&lt;em&gt;tmp&lt;/em&gt;" filter will be applied both to temporary folders and to Internet Explorer's cache.</dd></dl>
<p>Both '?' and '*' wildcards are accepted by filters. '?' character matches any one character, '*' - any zero or more characters. *.* pattern matches any file with an extension. An asterisk alone (*) matches anything (with or without an extension).</p>
<dl class="section note"><dt>Note</dt><dd>Files marked temporary by system are always excluded regardless of filters, because usually they take no effect on system performance.</dd>
<dd>
Files excluded from processing are never treated as fragmented. Because only files affecting system performance should get our attention.</dd></dl>
<h1>Examples</h1>
<dl class="section user"><dt>include only paths, which include one of these words</dt><dd><div class="fragment"><div class="line"><span class="keyword">set</span> UD_IN_FILTER=*windows*;*winnt*</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>eliminate only fragments below 20 MB in size</dt><dd><div class="fragment"><div class="line"><span class="keyword">set</span> UD_FRAGMENT_SIZE_THRESHOLD=20MB</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>process only files below 50 MB in size</dt><dd><div class="fragment"><div class="line"><span class="keyword">set</span> UD_FILE_SIZE_THRESHOLD=50MB</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>process only files with more than 6 fragments</dt><dd><div class="fragment"><div class="line"><span class="keyword">set</span> UD_FRAGMENTS_THRESHOLD=6</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>process only disks with fragmentation level above 10%</dt><dd><div class="fragment"><div class="line"><span class="keyword">set</span> UD_FRAGMENTATION_THRESHOLD=10</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>terminate processing after 6 hours and 30 minutes</dt><dd><div class="fragment"><div class="line"><span class="keyword">set</span> UD_TIME_LIMIT=6h 30m</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>save debugging information to the specified file</dt><dd><div class="fragment"><div class="line"><span class="keyword">set</span> UD_LOG_FILE_PATH=C:\Windows\Temp\defrag_native.log</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>defragment drive C:</dt><dd><div class="fragment"><div class="line">udefrag C:</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>list all available drives</dt><dd><div class="fragment"><div class="line">udefrag -la</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>analyze all drives excluding removable ones</dt><dd><div class="fragment"><div class="line">udefrag -a --all-fixed</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>optimize drives E: and K:</dt><dd><div class="fragment"><div class="line">udefrag -o E: K:</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>optimize the MFT of drives O: and Q:</dt><dd><div class="fragment"><div class="line">udefrag --optimize-mft O: Q:</div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>defragment the specified file and folder</dt><dd><div class="fragment"><div class="line">udefrag C:\Windows\WindowsUpdate.log <span class="stringliteral">&quot;C:\Program Files&quot;</span></div>
</div><!-- fragment --></dd></dl>
<h1>Example batch scripts</h1>
<p>The following example illustrates defragmentation of a few different disks in series adjusting parameters separately for each disk. </p>
<div class="fragment"><div class="line">@echo off</div>
<div class="line"></div>
<div class="line"><span class="keyword">set</span> UD_EX_FILTER=*system volume information*;*temp*;*tmp*;*recycle*;*.zip;*.7z;*.rar</div>
<div class="line"><span class="keyword">set</span> UD_FILE_SIZE_THRESHOLD=50MB</div>
<div class="line">udefrag c: &gt; c:\ud.log</div>
<div class="line"></div>
<div class="line"><span class="keyword">set</span> UD_IN_FILTER=D:\My Documents\*</div>
<div class="line">udefrag d: &gt;&gt; c:\ud.log</div>
<div class="line"></div>
<div class="line"><span class="keyword">set</span> UD_IN_FILTER=</div>
<div class="line">udefrag e: &gt;&gt; c:\ud.log</div>
</div><!-- fragment --><p> Notice that we are excluding archives in the script above. Because they are usually rarely accessed and may be left fragmented therefore without noticeable system performance degradation.</p>
<p>The next example demonstrates how the complex disk defragmentation job may be automated easily. </p>
<div class="fragment"><div class="line">@echo off</div>
<div class="line"></div>
<div class="line">rem Defragment small files.</div>
<div class="line"></div>
<div class="line">set UD_FILE_SIZE_THRESHOLD=50MB</div>
<div class="line">udefrag c:</div>
<div class="line"></div>
<div class="line">rem Defragment large files </div>
<div class="line">rem which have at least 5 fragments.</div>
<div class="line"></div>
<div class="line">set UD_FILE_SIZE_THRESHOLD=</div>
<div class="line"><span class="keyword">set</span> UD_FRAGMENTS_THRESHOLD=5</div>
<div class="line">udefrag c:</div>
</div><!-- fragment --><p>The following three commands are very useful in disk defragmentation scripts too:</p>
<ul>
<li><b>chkdsk</b> checks disks for errors and corrects them</li>
<li><b>shutdown -s -t 00</b> automatically shuts down the computer</li>
<li><b>hibernate4win now</b> hibernates the computer</li>
</ul>
<p>The last command is included in the UltraDefrag package. It was especially created to hibernate the computer through the command line after a disk defragmentation, which may take some time to finish.</p>
<h1>Explorer's context menu handler</h1>
<p>The UltraDefrag command line tool is also used as an Explorer's context menu handler. When you right click a drive, folder or file icon in Explorer, you can select an appropriate menu item to defragment the selected object.</p>
<p>To stop the defragmentation press Ctrl+C keys or close the command prompt.</p>
<p>To configure the context menu handler edit the IV-th section of the <b>%UD_INSTALL_DIR%\options\guiopts.lua</b> file.</p>
<p>Currently the context menu handler is not available in the portable version of the program.</p>
 
<HR>
 <TABLE STYLE="border: none; width: 97%; margin:auto;">
   <TR>
     <TD STYLE="text-align: left; width: 50%;">Previous: <a href="Installation.html">Installation</a></TD>
     <TD STYLE="text-align: right; width: 50%;">Next: <a href="Schedule.html">Scheduled Defragmentation</a></TD>
   </TR>
 </TABLE>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
